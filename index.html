<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#1a4d2a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ğŸ Ù…Ø§Ø± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ | Ù†Ø³Ø®Ù‡ Ø·Ù„Ø§ÛŒÛŒ</title>
    
    <!-- ÙÙˆÙ†Øª ÙØ§Ø±Ø³ÛŒ Ùˆ Ø¢ÛŒÚ©ÙˆÙ†â€ŒÙ‡Ø§ -->
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* ============== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ CSS ============== */
        :root {
            --primary-dark: #0a2f1a;
            --primary: #1e5a2e;
            --primary-light: #3a8a4a;
            --accent: #ffb74d;
            --accent-dark: #ff9800;
            --danger: #f44336;
            --danger-dark: #d32f2f;
            --text-light: #f8f9d7;
            --text-gold: #ffd966;
            --shadow: rgba(0, 0, 0, 0.5);
            --glow: rgba(76, 175, 80, 0.6);
        }

        /* ============== Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„ ============== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Vazirmatn', system-ui, -apple-system, sans-serif;
        }

        /* ============== Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ ============== */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--glow); }
            50% { box-shadow: 0 0 20px var(--glow); }
            100% { box-shadow: 0 0 5px var(--glow); }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* ============== Ø§Ø³ØªØ§ÛŒÙ„ Ø§ØµÙ„ÛŒ ============== */
        body {
            background: radial-gradient(circle at center, #1a3a1a 0%, #0a1f0a 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100dvh;
            padding: 16px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.05"><path d="M20 20 L30 20 L30 30 L20 30 Z" fill="white"/><path d="M70 70 L80 70 L80 80 L70 80 Z" fill="white"/></svg>');
            pointer-events: none;
        }

        .game-wrapper {
            max-width: 550px;
            width: 100%;
            background: linear-gradient(145deg, #1f4a2a, #15331e);
            border-radius: 48px 48px 32px 32px;
            padding: 24px 20px;
            box-shadow: 0 30px 40px rgba(0, 0, 0, 0.6), inset 0 0 0 2px #4f9a5e, inset 0 0 15px #a5d6a5;
            border: 1px solid #6f9e7a;
            animation: fadeIn 0.6s ease-out;
            position: relative;
            backdrop-filter: blur(5px);
        }

        /* ============== Ù‡Ø¯Ø± Ùˆ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª ============== */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding: 0 8px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #0f2a1a;
            padding: 8px 20px;
            border-radius: 50px;
            box-shadow: inset 0 -4px 0 #2a4a2a, inset 0 2px 10px rgba(0,0,0,0.7);
            border: 1px solid #6a9e7a;
        }

        .logo span {
            font-size: 28px;
            animation: pulse 2s infinite;
        }

        .logo h1 {
            color: var(--text-gold);
            font-size: 22px;
            font-weight: 900;
            text-shadow: 2px 2px 0 #1e3a1e;
            letter-spacing: 2px;
        }

        .score-container {
            display: flex;
            gap: 12px;
        }

        .score-card, .highscore-card {
            background: #0f2a1a;
            padding: 10px 20px;
            border-radius: 40px;
            box-shadow: inset 0 -4px 0 #2a4a2a, inset 0 2px 10px rgba(0,0,0,0.7);
            border: 1px solid #6a9e7a;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-gold);
            font-weight: 700;
            font-size: 20px;
            transition: all 0.3s ease;
        }

        .score-card:hover, .highscore-card:hover {
            transform: translateY(-2px);
            box-shadow: inset 0 -6px 0 #2a4a2a, inset 0 2px 15px rgba(0,0,0,0.8);
        }

        /* ============== Ú©Ø§Ù†ÙˆØ§Ø³ Ø¨Ø§Ø²ÛŒ ============== */
        .canvas-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(145deg, #0a1e12, #0c2a14);
            border-radius: 28px;
            padding: 15px;
            box-shadow: inset 0 0 0 3px #2b5e2b, inset 0 0 30px #000000, 0 15px 25px black;
            margin-bottom: 20px;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
            background: #0d2818;
            background-image: 
                linear-gradient(rgba(30, 90, 46, 0.2) 1px, transparent 1px),
                linear-gradient(90deg, rgba(30, 90, 46, 0.2) 1px, transparent 1px);
            background-size: 20px 20px;
            border-radius: 18px;
            border: 3px solid #4caf50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
        }

        .overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(10, 30, 10, 0.9);
            backdrop-filter: blur(5px);
            padding: 25px 45px;
            border-radius: 60px;
            border: 3px solid #ffd966;
            box-shadow: 0 0 30px rgba(255, 217, 102, 0.5);
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            color: white;
            font-size: 28px;
            font-weight: bold;
            animation: glow 2s infinite;
        }

        .overlay span {
            font-size: 50px;
        }

        /* ============== ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ ============== */
        .game-status {
            background: linear-gradient(145deg, #1c3c1c, #143014);
            padding: 16px 24px;
            border-radius: 50px;
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #8bc34a;
            box-shadow: inset 0 -3px 0 #2a4a2a, inset 0 2px 10px black;
            color: var(--text-gold);
        }

        .status-message {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 18px;
            font-weight: 600;
        }

        .status-icon {
            width: 36px;
            height: 36px;
            background: #ffb74d;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: pulse 1.5s infinite;
        }

        .difficulty-badge {
            background: #0f2a1a;
            padding: 8px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            border: 1px solid #ffb74d;
        }

        /* ============== Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ ============== */
        .touch-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
        }

        .dpad-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            width: 100%;
        }

        .dpad-row {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .control-btn {
            background: linear-gradient(145deg, #3a6b47, #2a4a2a);
            border: none;
            border-bottom: 8px solid #1e3a1e;
            color: white;
            font-size: 40px;
            width: 95px;
            height: 95px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 30px;
            box-shadow: 0 10px 0 #0a1a0a, 0 15px 25px rgba(0,0,0,0.5);
            transition: all 0.06s cubic-bezier(0.18, 0.89, 0.32, 1.28);
            cursor: pointer;
            font-weight: bold;
            position: relative;
            overflow: hidden;
        }

        .control-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 80%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .control-btn:active {
            transform: translateY(10px);
            box-shadow: 0 2px 0 #0a1a0a, 0 15px 25px black;
            border-bottom-width: 4px;
            background: linear-gradient(145deg, #4c8c5c, #3a6b47);
        }

        .control-btn:active::after {
            opacity: 1;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 25px;
            width: 100%;
            margin-top: 15px;
        }

        .action-btn {
            background: linear-gradient(145deg, #b9793b, #8e5a2a);
            border-bottom-color: #5a3a1a;
            font-size: 28px;
            width: 180px;
            height: 80px;
            border-radius: 50px;
            display: flex;
            gap: 12px;
        }

        .restart-btn {
            background: linear-gradient(145deg, #9e3c3c, #7a2e2e);
            border-bottom-color: #4a1e1e;
        }

        /* ============== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ============== */
        .game-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 25px;
            padding: 12px 20px;
            background: #0f2a1a80;
            border-radius: 40px;
            backdrop-filter: blur(5px);
            border: 1px solid #5a8a5a;
            color: #ffd966;
            font-size: 15px;
        }

        .speed-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .speed-bar {
            width: 80px;
            height: 10px;
            background: #2a4a2a;
            border-radius: 10px;
            overflow: hidden;
        }

        .speed-fill {
            height: 100%;
            width: 70%;
            background: linear-gradient(90deg, #ffb74d, #ff9800);
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        /* ============== Ù…Ø¯Ø§Ù„ Ùˆ Ø§ÙØªØ®Ø§Ø±Ø§Øª ============== */
        .achievement-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, #ffb74d, #ff9800);
            color: #0a1f0a;
            padding: 16px 30px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 18px;
            display: none;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 30px rgba(255, 152, 0, 0.5);
            border: 2px solid white;
            z-index: 1000;
            animation: slideIn 0.5s ease;
        }

        /* ============== Ø±Ø³Ù¾Ø§Ù†Ø³ÛŒÙˆ ============== */
        @media (max-width: 450px) {
            .control-btn { width: 80px; height: 80px; font-size: 35px; }
            .action-btn { width: 150px; height: 70px; }
            .logo h1 { font-size: 18px; }
            .score-card, .highscore-card { padding: 8px 15px; font-size: 18px; }
        }

        @media (max-width: 380px) {
            .control-btn { width: 70px; height: 70px; font-size: 30px; }
            .action-btn { width: 130px; height: 65px; font-size: 24px; }
        }

        /* ============== Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ ============== */
        .hidden { display: none; }
        .shake-animation { animation: shake 0.5s ease; }
        .glow-animation { animation: glow 2s infinite; }
    </style>
</head>
<body>
    <!-- ============== ØªØ§ÛŒÙ…Ø± Ø¯Ø³ØªØ§ÙˆØ±Ø¯ ============== -->
    <div id="achievementToast" class="achievement-toast">
        <span>ğŸ†</span>
        <span id="achievementText">Ø§Ù…ØªÛŒØ§Ø² Ø¬Ø¯ÛŒØ¯!</span>
    </div>

    <!-- ============== Ú©Ø§Ù†ØªÛŒÙ†Ø± Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ ============== -->
    <div class="game-wrapper">
        
        <!-- ============== Ù‡Ø¯Ø± ============== -->
        <div class="game-header">
            <div class="logo">
                <span>ğŸ</span>
                <h1>Ù…Ø§Ø± Ø·Ù„Ø§ÛŒÛŒ</h1>
            </div>
            <div class="score-container">
                <div class="score-card">
                    <span>ğŸ</span>
                    <span id="currentScore">0</span>
                </div>
                <div class="highscore-card">
                    <span>ğŸ‘‘</span>
                    <span id="highScore">0</span>
                </div>
            </div>
        </div>

        <!-- ============== Ú©Ø§Ù†ØªÛŒÙ†Ø± Ú©Ø§Ù†ÙˆØ§Ø³ Ø¨Ø§ Ø§ÙˆÙˆØ±Ù„ÛŒ ============== -->
        <div class="canvas-container">
            <canvas id="gameCanvas" width="400" height="400"></canvas>
            <div id="gameOverlay" class="overlay">
                <span>ğŸ®</span>
                <span id="overlayText">Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯</span>
            </div>
        </div>

        <!-- ============== ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ ============== -->
        <div class="game-status">
            <div class="status-message">
                <span class="status-icon" id="statusIcon">â–¶ï¸</span>
                <span id="statusMessage">Ø¢Ù…Ø§Ø¯Ù‡ Ø´Ø±ÙˆØ¹</span>
            </div>
            <div class="difficulty-badge">
                <span>âš¡</span>
                <span id="difficultyLevel">Ø¹Ø§Ø¯ÛŒ</span>
                <span id="speedValue">120</span>
                <span>ms</span>
            </div>
        </div>

        <!-- ============== Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ ============== -->
        <div class="touch-controls">
            <!-- D-Pad -->
            <div class="dpad-container">
                <div class="dpad-row">
                    <button class="control-btn" id="btnUp" aria-label="Ø¨Ø§Ù„Ø§">
                        <span>â¬†ï¸</span>
                    </button>
                </div>
                <div class="dpad-row">
                    <button class="control-btn" id="btnLeft" aria-label="Ú†Ù¾">
                        <span>â¬…ï¸</span>
                    </button>
                    <button class="control-btn" id="btnDown" aria-label="Ù¾Ø§ÛŒÛŒÙ†">
                        <span>â¬‡ï¸</span>
                    </button>
                    <button class="control-btn" id="btnRight" aria-label="Ø±Ø§Ø³Øª">
                        <span>â¡ï¸</span>
                    </button>
                </div>
            </div>
            
            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§Ú©Ø´Ù† -->
            <div class="action-buttons">
                <button class="control-btn action-btn" id="btnPause">
                    <span>â¸ï¸</span>
                    <span>ØªÙˆÙ‚Ù</span>
                </button>
                <button class="control-btn action-btn restart-btn" id="btnRestart">
                    <span>ğŸ”„</span>
                    <span>Ø´Ø±ÙˆØ¹</span>
                </button>
            </div>
        </div>

        <!-- ============== ÙÙˆØªØ± Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ============== -->
        <div class="game-footer">
            <div class="speed-indicator">
                <span>ğŸ</span>
                <span>Ø³Ø±Ø¹Øª:</span>
                <div class="speed-bar">
                    <div id="speedFill" class="speed-fill" style="width: 40%;"></div>
                </div>
            </div>
            <div>
                <span>ğŸ“± Ù†Ø³Ø®Ù‡ Û².Û° Ø·Ù„Ø§ÛŒÛŒ</span>
            </div>
            <div>
                <span id="foodCount">ğŸ Û°</span>
            </div>
        </div>
    </div>

    <script>
        // ============== Ú©Ù„Ø§Ø³ Ù…Ø¯ÛŒØ±ÛŒØª Ø¨Ø§Ø²ÛŒ Ù…Ø§Ø± ==============
        class SnakeGame {
            // ============== Ù…Ù‚Ø§Ø¯ÛŒØ± Ø«Ø§Ø¨Øª ==============
            static GRID_SIZE = 20;
            static TILE_SIZE = 20;
            static INITIAL_SPEED = 120;
            static MIN_SPEED = 50;
            static SPEED_DECREMENT = 8;
            static SCORE_PER_FOOD = 10;
            static HIGH_SCORE_KEY = 'goldenSnakeHighScore';

            // ============== Ø³Ø§Ø²Ù†Ø¯Ù‡ Ú©Ù„Ø§Ø³ ==============
            constructor(canvasId) {
                // Ø§Ù„Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒ DOM
                this.canvas = document.getElementById(canvasId);
                this.ctx = this.canvas.getContext('2d');
                this.scoreElement = document.getElementById('currentScore');
                this.highScoreElement = document.getElementById('highScore');
                this.statusMessage = document.getElementById('statusMessage');
                this.statusIcon = document.getElementById('statusIcon');
                this.overlay = document.getElementById('gameOverlay');
                this.overlayText = document.getElementById('overlayText');
                this.speedFill = document.getElementById('speedFill');
                this.difficultyLevel = document.getElementById('difficultyLevel');
                this.speedValue = document.getElementById('speedValue');
                this.foodCount = document.getElementById('foodCount');
                this.achievementToast = document.getElementById('achievementToast');
                this.achievementText = document.getElementById('achievementText');

                // ============== ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø²ÛŒ ==============
                this.snake = [{ x: 10, y: 10 }];
                this.direction = { x: 0, y: 0 };
                this.nextDirection = { x: 0, y: 0 };
                this.food = { x: 15, y: 15 };
                this.score = 0;
                this.highScore = this.loadHighScore();
                this.gameRunning = false;
                this.gamePaused = false;
                this.gameLoop = null;
                this.speed = SnakeGame.INITIAL_SPEED;
                this.foodsEaten = 0;
                
                // ============== Ø±Ù†Ú¯â€ŒØ¨Ù†Ø¯ÛŒ ==============
                this.colors = {
                    snakeHead: '#a5d6a5',
                    snakeBody: '#66bb6a',
                    snakeHeadGradient: '#c8e6c9',
                    food: '#ff5252',
                    foodLeaf: '#69f0ae',
                    grid: '#2e7d32',
                    background: '#0d2818'
                };

                // ============== ØµØ¯Ø§Ù‡Ø§ (Ø¢Ù¾Ø´Ù†Ø§Ù„) ==============
                this.sounds = {
                    eat: null,
                    gameOver: null,
                    move: null
                };

                // ============== Ø¢Ù…Ø§Ø± Ù¾ÛŒØ´Ø±ÙØªÙ‡ ==============
                this.stats = {
                    gamesPlayed: 0,
                    totalFoodEaten: 0,
                    maxLength: 1,
                    playTime: 0,
                    startTime: null
                };

                // Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
                this.loadStats();
                this.highScoreElement.innerText = this.highScore;
                this.generateFood();
                this.draw();
                this.setupEventListeners();
            }

            // ============== Ù…Ø¯ÛŒØ±ÛŒØª localStorage ==============
            loadHighScore() {
                try {
                    return parseInt(localStorage.getItem(SnakeGame.HIGH_SCORE_KEY)) || 0;
                } catch(e) {
                    console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø®ÙˆØ§Ù†Ø¯Ù† localStorage');
                    return 0;
                }
            }

            saveHighScore() {
                try {
                    localStorage.setItem(SnakeGame.HIGH_SCORE_KEY, this.highScore);
                } catch(e) {
                    console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ localStorage');
                }
            }

            loadStats() {
                try {
                    const savedStats = localStorage.getItem('snakeStats');
                    if(savedStats) {
                        this.stats = { ...this.stats, ...JSON.parse(savedStats) };
                    }
                } catch(e) {}
            }

            saveStats() {
                try {
                    localStorage.setItem('snakeStats', JSON.stringify(this.stats));
                } catch(e) {}
            }

            // ============== ØªÙˆÙ„ÛŒØ¯ ØºØ°Ø§ Ø¨Ø§ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ ==============
            generateFood() {
                const maxAttempts = 1000;
                let attempts = 0;
                let found = false;

                // Ø§Ø³ØªØ±Ø§ØªÚ˜ÛŒ: Ø³Ø¹ÛŒ Ú©Ù† ØºØ°Ø§ Ø¯ÙˆØ± Ø§Ø² Ø³Ø± Ù…Ø§Ø± Ø¨Ø§Ø´Ù‡
                while (!found && attempts < maxAttempts) {
                    attempts++;
                    
                    // Û·Û°Ùª Ù…ÙˆØ§Ù‚Ø¹ ØºØ°Ø§ Ø¯ÙˆØ± Ø§Ø² Ø³Ø± Ù…Ø§Ø± Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù‡
                    let x, y;
                    if (Math.random() < 0.7 && this.snake.length > 0) {
                        const head = this.snake[0];
                        x = (head.x + Math.floor(Math.random() * 10 - 5) + SnakeGame.GRID_SIZE) % SnakeGame.GRID_SIZE;
                        y = (head.y + Math.floor(Math.random() * 10 - 5) + SnakeGame.GRID_SIZE) % SnakeGame.GRID_SIZE;
                    } else {
                        x = Math.floor(Math.random() * SnakeGame.GRID_SIZE);
                        y = Math.floor(Math.random() * SnakeGame.GRID_SIZE);
                    }

                    // Ø¨Ø±Ø±Ø³ÛŒ Ù†Ø¨ÙˆØ¯Ù† ØºØ°Ø§ Ø±ÙˆÛŒ Ù…Ø§Ø±
                    found = !this.snake.some(segment => segment.x === x && segment.y === y);
                    
                    if (found) {
                        this.food = { x, y };
                    }
                }

                // Ø§Ú¯Ù‡ Ù¾ÛŒØ¯Ø§Ø´ Ù†Ú©Ø±Ø¯ØŒ ÛŒÙ‡ Ø¬Ø§ÛŒ Ø®Ø§Ù„ÛŒ ØªØµØ§Ø¯ÙÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ù†
                if (!found) {
                    for (let y = 0; y < SnakeGame.GRID_SIZE; y++) {
                        for (let x = 0; x < SnakeGame.GRID_SIZE; x++) {
                            if (!this.snake.some(s => s.x === x && s.y === y)) {
                                this.food = { x, y };
                                return;
                            }
                        }
                    }
                    // Ø§Ú¯Ù‡ Ú©Ù„ ØµÙØ­Ù‡ Ù¾Ø±Ù‡ØŒ Ø¨Ø§Ø®Øª
                    this.gameOver();
                }
            }

            // ============== Ø³ÛŒØ³ØªÙ… Ø±Ø³Ù… Ù¾ÛŒØ´Ø±ÙØªÙ‡ ==============
            draw() {
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡
                this.ctx.fillStyle = this.colors.background;
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);

                // Ø±Ø³Ù… Ú¯Ø±ÛŒØ¯ Ø¨Ø§ Ø³Ø§ÛŒÙ‡
                this.drawGrid();

                // Ø±Ø³Ù… ØºØ°Ø§
                this.drawFood();

                // Ø±Ø³Ù… Ù…Ø§Ø±
                this.drawSnake();

                // Ø±Ø³Ù… Ø§ÙÚ©Øªâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡
                this.drawSpecialEffects();
            }

            drawGrid() {
                this.ctx.strokeStyle = '#2e7d3233';
                this.ctx.lineWidth = 0.6;
                
                for (let i = 0; i <= SnakeGame.GRID_SIZE; i++) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(i * SnakeGame.TILE_SIZE, 0);
                    this.ctx.lineTo(i * SnakeGame.TILE_SIZE, this.canvas.height);
                    this.ctx.strokeStyle = i % 5 === 0 ? '#4caf5055' : '#2e7d3233';
                    this.ctx.stroke();
                    
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, i * SnakeGame.TILE_SIZE);
                    this.ctx.lineTo(this.canvas.width, i * SnakeGame.TILE_SIZE);
                    this.ctx.stroke();
                }
            }

            drawSnake() {
                // Ø³Ø§ÛŒÙ‡
                this.ctx.shadowColor = 'rgba(0, 0, 0, 0.5)';
                this.ctx.shadowBlur = 5;
                this.ctx.shadowOffsetX = 2;
                this.ctx.shadowOffsetY = 2;

                // Ø±Ø³Ù… Ø¨Ø¯Ù†
                for (let i = this.snake.length - 1; i >= 0; i--) {
                    const segment = this.snake[i];
                    const isHead = i === 0;
                    const x = segment.x * SnakeGame.TILE_SIZE;
                    const y = segment.y * SnakeGame.TILE_SIZE;
                    
                    // Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª Ø¨Ø±Ø§ÛŒ Ø¨Ø¯Ù†
                    const gradient = this.ctx.createRadialGradient(
                        x + 5, y + 5, 2,
                        x + 10, y + 10, 15
                    );
                    
                    if (isHead) {
                        gradient.addColorStop(0, '#c8e6c9');
                        gradient.addColorStop(1, '#81c784');
                    } else {
                        const percent = 1 - (i / this.snake.length);
                        gradient.addColorStop(0, `rgba(102, 187, 106, ${percent})`);
                        gradient.addColorStop(1, '#388e3c');
                    }
                    
                    this.ctx.fillStyle = gradient;
                    
                    // Ø¨Ø¯Ù†Ù‡ Ø¨Ø§ Ú¯ÙˆØ´Ù‡â€ŒÙ‡Ø§ÛŒ Ú¯Ø±Ø¯
                    const padding = isHead ? 2 : 3;
                    this.ctx.fillRect(
                        x + padding/2,
                        y + padding/2,
                        SnakeGame.TILE_SIZE - padding,
                        SnakeGame.TILE_SIZE - padding
                    );

                    // Ú†Ø´Ù… Ø¨Ø±Ø§ÛŒ Ø³Ø±
                    if (isHead) {
                        this.drawSnakeEyes(x, y);
                    }
                    
                    // Ø§Ù„Ú¯Ùˆ Ø¨Ø±Ø§ÛŒ Ø¨Ø¯Ù†
                    if (!isHead && i % 3 === 0) {
                        this.ctx.fillStyle = '#2e7d3240';
                        this.ctx.fillRect(
                            x + 5,
                            y + 5,
                            2, 2
                        );
                    }
                }

                // Ø±ÛŒØ³Øª Ø³Ø§ÛŒÙ‡
                this.ctx.shadowBlur = 0;
                this.ctx.shadowOffsetX = 0;
                this.ctx.shadowOffsetY = 0;
            }

            drawSnakeEyes(x, y) {
                // Ø³ÙÛŒØ¯ÛŒ Ú†Ø´Ù…
                this.ctx.fillStyle = 'white';
                this.ctx.shadowBlur = 2;
                
                let eyeXOffset1, eyeXOffset2, eyeYOffset;
                
                // Ø¬Ù‡Øª Ú†Ø´Ù… Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ù‡Øª Ø­Ø±Ú©Øª
                if (this.direction.x === 1) { // Ø±Ø§Ø³Øª
                    eyeXOffset1 = 12; eyeXOffset2 = 12; eyeYOffset = 5;
                } else if (this.direction.x === -1) { // Ú†Ù¾
                    eyeXOffset1 = 3; eyeXOffset2 = 3; eyeYOffset = 5;
                } else if (this.direction.y === -1) { // Ø¨Ø§Ù„Ø§
                    eyeXOffset1 = 5; eyeXOffset2 = 12; eyeYOffset = 3;
                } else if (this.direction.y === 1) { // Ù¾Ø§ÛŒÛŒÙ†
                    eyeXOffset1 = 5; eyeXOffset2 = 12; eyeYOffset = 12;
                } else { // Ø«Ø§Ø¨Øª
                    eyeXOffset1 = 5; eyeXOffset2 = 12; eyeYOffset = 5;
                }

                this.ctx.beginPath();
                this.ctx.arc(x + eyeXOffset1, y + eyeYOffset, 2.5, 0, Math.PI * 2);
                this.ctx.arc(x + eyeXOffset2, y + eyeYOffset, 2.5, 0, Math.PI * 2);
                this.ctx.fill();
                
                // Ù…Ø±Ø¯Ù…Ú©
                this.ctx.fillStyle = '#0a0a0a';
                this.ctx.shadowBlur = 0;
                this.ctx.beginPath();
                this.ctx.arc(x + eyeXOffset1 + (this.direction.x === 1 ? 1 : 0), y + eyeYOffset + (this.direction.y === 1 ? 1 : 0), 1.2, 0, Math.PI * 2);
                this.ctx.arc(x + eyeXOffset2 + (this.direction.x === 1 ? 1 : 0), y + eyeYOffset + (this.direction.y === 1 ? 1 : 0), 1.2, 0, Math.PI * 2);
                this.ctx.fill();
            }

            drawFood() {
                const x = this.food.x * SnakeGame.TILE_SIZE;
                const y = this.food.y * SnakeGame.TILE_SIZE;
                const centerX = x + SnakeGame.TILE_SIZE / 2;
                const centerY = y + SnakeGame.TILE_SIZE / 2;

                // Ø³Ø§ÛŒÙ‡
                this.ctx.shadowColor = '#ff000080';
                this.ctx.shadowBlur = 12;
                
                // Ø³ÛŒØ¨
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, SnakeGame.TILE_SIZE / 2 - 2, 0, Math.PI * 2);
                
                // Ú¯Ø±Ø§Ø¯ÛŒØ§Ù†Øª Ø³ÛŒØ¨
                const gradient = this.ctx.createRadialGradient(
                    centerX - 2, centerY - 2, 2,
                    centerX, centerY, SnakeGame.TILE_SIZE / 2
                );
                gradient.addColorStop(0, '#ff7043');
                gradient.addColorStop(1, '#d32f2f');
                
                this.ctx.fillStyle = gradient;
                this.ctx.fill();

                // Ø¨Ø±Ú¯
                this.ctx.shadowBlur = 6;
                this.ctx.fillStyle = '#66bb6a';
                this.ctx.beginPath();
                this.ctx.ellipse(
                    centerX + 4,
                    centerY - 6,
                    3, 5, 0.5, 0, Math.PI * 2
                );
                this.ctx.fill();

                // Ø¨Ø±Ù‚
                this.ctx.shadowBlur = 4;
                this.ctx.fillStyle = 'rgba(255, 255, 255, 0.6)';
                this.ctx.beginPath();
                this.ctx.arc(centerX - 2, centerY - 2, 1.5, 0, Math.PI * 2);
                this.ctx.fill();

                // Ø±ÛŒØ³Øª Ø³Ø§ÛŒÙ‡
                this.ctx.shadowBlur = 0;
            }

            drawSpecialEffects() {
                // Ø§ÙÚ©Øª Ø¨Ø±Ø§ÛŒ Ø³Ø± Ù…Ø§Ø±
                if (this.gameRunning && !this.gamePaused) {
                    const head = this.snake[0];
                    const x = head.x * SnakeGame.TILE_SIZE;
                    const y = head.y * SnakeGame.TILE_SIZE;
                    
                    this.ctx.shadowColor = '#4caf5080';
                    this.ctx.shadowBlur = 15;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(
                        x + SnakeGame.TILE_SIZE/2,
                        y + SnakeGame.TILE_SIZE/2,
                        SnakeGame.TILE_SIZE/2 + 2,
                        0, Math.PI * 2
                    );
                    this.ctx.fillStyle = 'rgba(76, 175, 80, 0.1)';
                    this.ctx.fill();
                    
                    this.ctx.shadowBlur = 0;
                }
            }

            // ============== Ù…Ù†Ø·Ù‚ Ø§ØµÙ„ÛŒ Ø¨Ø§Ø²ÛŒ ==============
            update() {
                if (!this.gameRunning || this.gamePaused) return;

                // Ø§Ø¹Ù…Ø§Ù„ Ø¬Ù‡Øª Ø¬Ø¯ÛŒØ¯
                if (this.nextDirection.x !== 0 || this.nextDirection.y !== 0) {
                    if (!(this.direction.x === -this.nextDirection.x && this.direction.y === -this.nextDirection.y)) {
                        this.direction = { ...this.nextDirection };
                    }
                }

                // Ø§Ú¯Ù‡ Ø¬Ù‡Øª ØµÙØ±Ù‡ØŒ Ø­Ø±Ú©Øª Ù†Ú©Ù†
                if (this.direction.x === 0 && this.direction.y === 0) return;

                const head = {
                    x: this.snake[0].x + this.direction.x,
                    y: this.snake[0].y + this.direction.y
                };

                // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø¯ÛŒÙˆØ§Ø±
                if (head.x < 0 || head.x >= SnakeGame.GRID_SIZE || head.y < 0 || head.y >= SnakeGame.GRID_SIZE) {
                    this.gameOver();
                    return;
                }

                // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø®ÙˆØ¯
                if (this.snake.some(segment => segment.x === head.x && segment.y === head.y)) {
                    this.gameOver();
                    return;
                }

                // Ø­Ø±Ú©Øª Ù…Ø§Ø±
                this.snake.unshift(head);

                // Ø®ÙˆØ±Ø¯Ù† ØºØ°Ø§
                if (head.x === this.food.x && head.y === this.food.y) {
                    this.handleEatFood();
                } else {
                    this.snake.pop();
                }

                // Ø¢Ù¾Ø¯ÛŒØª UI
                this.draw();
                this.updateUI();
            }

            handleEatFood() {
                // Ø§ÙØ²Ø§ÛŒØ´ Ø§Ù…ØªÛŒØ§Ø²
                this.score += SnakeGame.SCORE_PER_FOOD;
                this.foodsEaten++;
                this.stats.totalFoodEaten++;
                this.stats.maxLength = Math.max(this.stats.maxLength, this.snake.length);
                
                // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù†Ù…Ø§ÛŒØ´
                this.scoreElement.innerText = this.score;
                this.foodCount.innerText = `ğŸ ${this.foodsEaten}`;
                
                // Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯
                if (this.score > this.highScore) {
                    this.highScore = this.score;
                    this.saveHighScore();
                    this.highScoreElement.innerText = this.highScore;
                    this.showAchievement('ğŸ† Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯!', this.highScore);
                }

                // ØªÙˆÙ„ÛŒØ¯ ØºØ°Ø§ÛŒ Ø¬Ø¯ÛŒØ¯
                this.generateFood();

                // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª
                if (this.score % 30 === 0 && this.speed > SnakeGame.MIN_SPEED) {
                    this.speed -= SnakeGame.SPEED_DECREMENT;
                    this.resetGameLoop();
                    this.updateDifficultyLabel();
                }

                // Ù„Ø±Ø²Ø´ ØµÙØ­Ù‡ (Ø®ÙÛŒÙ)
                this.shakeCanvas();
            }

            gameOver() {
                this.gameRunning = false;
                this.gamePaused = false;
                this.stats.gamesPlayed++;
                this.saveStats();
                
                clearInterval(this.gameLoop);
                this.gameLoop = null;
                
                // Ù†Ù…Ø§ÛŒØ´ Ø§ÙˆÙˆØ±Ù„ÛŒ
                this.overlay.style.display = 'flex';
                this.overlayText.innerText = 'ğŸ’€ Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯';
                this.statusIcon.innerText = 'ğŸ’€';
                this.statusMessage.innerText = 'Ø¨Ø§Ø®ØªÛŒØ¯! Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯';
                
                // Ø§ÙÚ©Øª Ù„Ø±Ø²Ø´
                document.querySelector('.canvas-container').classList.add('shake-animation');
                setTimeout(() => {
                    document.querySelector('.canvas-container').classList.remove('shake-animation');
                }, 500);
                
                this.draw();
            }

            // ============== Ú©Ù†ØªØ±Ù„ Ø¨Ø§Ø²ÛŒ ==============
            startGame() {
                if (this.gameRunning) return;
                
                this.gameRunning = true;
                this.gamePaused = false;
                this.overlay.style.display = 'none';
                this.statusIcon.innerText = 'â–¶ï¸';
                this.statusMessage.innerText = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²ÛŒ...';
                
                this.resetGameLoop();
            }

            pauseGame() {
                if (!this.gameRunning) return;
                
                this.gamePaused = !this.gamePaused;
                
                if (this.gamePaused) {
                    clearInterval(this.gameLoop);
                    this.gameLoop = null;
                    this.statusIcon.innerText = 'â¸ï¸';
                    this.statusMessage.innerText = 'Ù…Ú©Ø«';
                    this.overlay.style.display = 'flex';
                    this.overlayText.innerText = 'â¸ï¸ Ù…Ú©Ø«';
                } else {
                    this.resetGameLoop();
                    this.statusIcon.innerText = 'â–¶ï¸';
                    this.statusMessage.innerText = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²ÛŒ...';
                    this.overlay.style.display = 'none';
                }
            }

            restartGame() {
                // Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„
                this.snake = [{ x: 10, y: 10 }];
                this.direction = { x: 1, y: 0 };
                this.nextDirection = { x: 1, y: 0 };
                this.score = 0;
                this.speed = SnakeGame.INITIAL_SPEED;
                this.foodsEaten = 0;
                
                this.scoreElement.innerText = '0';
                this.foodCount.innerText = 'ğŸ 0';
                
                this.gameRunning = true;
                this.gamePaused = false;
                
                this.generateFood();
                
                clearInterval(this.gameLoop);
                this.gameLoop = setInterval(() => this.update(), this.speed);
                
                this.overlay.style.display = 'none';
                this.statusIcon.innerText = 'â–¶ï¸';
                this.statusMessage.innerText = 'Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²ÛŒ...';
                this.updateDifficultyLabel();
                
                this.draw();
            }

            setDirection(x, y) {
                if (!this.gameRunning || this.gamePaused) return;
                
                // Ø°Ø®ÛŒØ±Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø¬Ù‡Øª Ø¨Ø¹Ø¯ÛŒ
                this.nextDirection = { x, y };
            }

            // ============== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ==============
            resetGameLoop() {
                if (this.gameLoop) clearInterval(this.gameLoop);
                if (this.gameRunning && !this.gamePaused) {
                    this.gameLoop = setInterval(() => this.update(), this.speed);
                }
            }

            updateUI() {
                // Ø¢Ù¾Ø¯ÛŒØª Ù†ÙˆØ§Ø± Ø³Ø±Ø¹Øª
                const speedPercent = 100 - ((this.speed - SnakeGame.MIN_SPEED) / (SnakeGame.INITIAL_SPEED - SnakeGame.MIN_SPEED) * 100);
                this.speedFill.style.width = `${Math.min(100, Math.max(20, speedPercent))}%`;
                
                // Ù…Ù‚Ø¯Ø§Ø± Ø³Ø±Ø¹Øª
                this.speedValue.innerText = this.speed;
            }

            updateDifficultyLabel() {
                if (this.speed > 100) {
                    this.difficultyLevel.innerText = 'Ø¢Ø³Ø§Ù†';
                } else if (this.speed > 70) {
                    this.difficultyLevel.innerText = 'Ø¹Ø§Ø¯ÛŒ';
                } else {
                    this.difficultyLevel.innerText = 'Ø³Ø®Øª';
                }
            }

            shakeCanvas() {
                this.canvas.classList.add('shake-animation');
                setTimeout(() => {
                    this.canvas.classList.remove('shake-animation');
                }, 300);
            }

            showAchievement(title, value) {
                this.achievementText.innerText = `${title} ${value}`;
                this.achievementToast.style.display = 'flex';
                
                setTimeout(() => {
                    this.achievementToast.style.display = 'none';
                }, 3000);
            }

            // ============== Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ ==============
            setupEventListeners() {
                // Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ú©Ù†ØªØ±Ù„ÛŒ
                document.getElementById('btnUp').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.setDirection(0, -1);
                });
                
                document.getElementById('btnDown').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.setDirection(0, 1);
                });
                
                document.getElementById('btnLeft').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.setDirection(-1, 0);
                });
                
                document.getElementById('btnRight').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.setDirection(1, 0);
                });
                
                document.getElementById('btnPause').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.pauseGame();
                });
                
                document.getElementById('btnRestart').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.restartGame();
                });

                // Ú©Ù†ØªØ±Ù„ Ø¨Ø§ Ú©ÛŒØ¨ÙˆØ±Ø¯
                window.addEventListener('keydown', (e) => {
                    if (!this.gameRunning || this.gamePaused) return;
                    
                    switch(e.key) {
                        case 'ArrowUp':
                            e.preventDefault();
                            this.setDirection(0, -1);
                            break;
                        case 'ArrowDown':
                            e.preventDefault();
                            this.setDirection(0, 1);
                            break;
                        case 'ArrowLeft':
                            e.preventDefault();
                            this.setDirection(-1, 0);
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            this.setDirection(1, 0);
                            break;
                        case ' ':
                            e.preventDefault();
                            this.pauseGame();
                            break;
                    }
                });

                // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø§ ØªØ§Ú†
                document.querySelectorAll('button').forEach(btn => {
                    btn.addEventListener('touchstart', (e) => e.preventDefault());
                });
            }
        }

        // ============== Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø§Ø²ÛŒ ==============
        document.addEventListener('DOMContentLoaded', () => {
            window.game = new SnakeGame('gameCanvas');
            
            // Ø´Ø±ÙˆØ¹ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø§ Ú©Ù…ÛŒ ØªØ£Ø®ÛŒØ±
            setTimeout(() => {
                if (!window.game.gameRunning) {
                    window.game.restartGame();
                }
            }, 500);
        });
    </script>
</body>
</html>
