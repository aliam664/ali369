<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SNAKE XTREME â€¢ Ù…Ø§Ø± Ø§ÙØ³Ø§Ù†Ù‡â€ŒØ§ÛŒ</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Vazirmatn:wght@300;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            background: radial-gradient(circle at 50% 30%, #0b0c14, #030507);
            font-family: 'Vazirmatn', 'Orbitron', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 16px;
            position: relative;
            overflow-x: hidden;
        }

        .game-universe {
            max-width: 750px;
            width: 100%;
            position: relative;
        }

        .game-arena {
            background: linear-gradient(145deg, #0f121c, #07090e);
            border-radius: 48px 48px 24px 24px;
            padding: 28px;
            box-shadow: 0 30px 40px -15px rgba(0,0,0,0.8), 
                        0 0 0 2px rgba(78, 205, 196, 0.15),
                        0 0 30px rgba(0, 255, 200, 0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
            overflow: hidden;
        }

        .game-arena::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(0,255,200,0.03) 0%, transparent 70%);
            animation: rotate 30s infinite linear;
            pointer-events: none;
        }

        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .neon-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            position: relative;
            z-index: 10;
            flex-wrap: wrap;
            gap: 12px;
        }

        .score-neon, .highscore-neon {
            background: rgba(10, 20, 30, 0.7);
            backdrop-filter: blur(10px);
            padding: 12px 28px;
            border-radius: 60px;
            border: 1px solid rgba(0, 255, 200, 0.5);
            box-shadow: 0 0 20px rgba(0, 255, 200, 0.3), inset 0 0 10px rgba(0,255,200,0.2);
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 700;
        }

        .score-label {
            color: #b0ffe0;
            font-size: 18px;
            letter-spacing: 3px;
            text-shadow: 0 0 8px cyan;
        }

        .score-value {
            background: #000;
            padding: 5px 18px;
            border-radius: 40px;
            color: #fff;
            font-size: 28px;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            box-shadow: inset 0 0 10px rgba(0,255,200,0.5), 0 0 15px cyan;
            border: 1px solid #4ecdc4;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 0 0 3px #1e2a3a, 0 0 0 6px rgba(20, 40, 50, 0.5), 0 25px 40px black;
        }

        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            background: #0a0e14;
            cursor: none;
        }

        .particle-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 20;
        }

        .power-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 28px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .status-hologram {
            background: rgba(0, 20, 30, 0.7);
            backdrop-filter: blur(8px);
            padding: 12px 28px;
            border-radius: 40px;
            border: 1px solid #48d1cc;
            box-shadow: 0 0 15px #48d1cc;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .pulse {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #0f0;
            box-shadow: 0 0 20px #0f0;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            100% { opacity: 0.5; transform: scale(1.2); }
        }

        .cyber-btn {
            background: rgba(16, 30, 40, 0.9);
            border: none;
            border-bottom: 4px solid #0e7a7a;
            color: #e0f2fe;
            font-size: 20px;
            font-weight: bold;
            padding: 14px 28px;
            border-radius: 40px;
            backdrop-filter: blur(5px);
            border: 1px solid #2aa19c;
            box-shadow: 0 8px 0 #0a4b4b, 0 0 20px rgba(0,255,200,0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            transition: 0.07s;
            cursor: pointer;
            font-family: 'Vazirmatn', sans-serif;
        }

        .cyber-btn:active {
            transform: translateY(8px);
            box-shadow: 0 0px 0 #0a4b4b, 0 0 30px cyan;
            border-bottom-width: 2px;
        }

        .direction-command {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            margin-top: 20px;
        }

        .direction-row {
            display: flex;
            gap: 18px;
            justify-content: center;
        }

        .neon-pad {
            background: #0b1a1e;
            border: 2px solid #249f9f;
            border-radius: 24px;
            padding: 16px 24px;
            box-shadow: 0 0 25px #1e9090, inset 0 0 10px #1e9090;
            display: flex;
            gap: 18px;
        }

        .dir-btn {
            background: #1e2c3a;
            border: none;
            border-bottom: 6px solid #0f1a22;
            color: #b4ecec;
            font-size: 36px;
            padding: 12px 24px;
            border-radius: 20px;
            cursor: pointer;
            transition: 0.06s;
            box-shadow: 0 10px 0 #0e1a1a, 0 0 20px #249f9f;
            text-shadow: 0 0 10px cyan;
        }

        .dir-btn:active {
            transform: translateY(10px);
            box-shadow: 0 0px 0 #0e1a1a, 0 0 40px cyan;
        }

        .speed-indicator {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #aaf0e9;
            font-size: 18px;
        }

        .speed-bar {
            width: 120px;
            height: 12px;
            background: #1e2a2a;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 5px black;
        }

        .speed-fill {
            height: 100%;
            width: 50%;
            background: linear-gradient(90deg, #00ffaa, #00ccff);
            border-radius: 10px;
            box-shadow: 0 0 15px #00ffff;
        }

        .achievement-badge {
            display: flex;
            gap: 8px;
        }

        .badge {
            background: #1e2430;
            padding: 8px 16px;
            border-radius: 30px;
            color: #ffd966;
            border: 1px solid gold;
            font-size: 14px;
        }

        @media (max-width: 600px) {
            .game-arena { padding: 16px; }
            .dir-btn { font-size: 28px; padding: 8px 16px; }
        }
    </style>
</head>
<body>
    <div class="game-universe">
        <div class="game-arena">
            <!-- Ù‡Ø¯Ø± Ù†Ø¦ÙˆÙ† -->
            <div class="neon-header">
                <div class="score-neon">
                    <span class="score-label">ğŸ Ø§Ù…ØªÛŒØ§Ø²</span>
                    <span id="scoreDisplay" class="score-value">0000</span>
                </div>
                <div class="highscore-neon">
                    <span class="score-label">ğŸ† Ø±Ú©ÙˆØ±Ø¯</span>
                    <span id="highScoreDisplay" class="score-value">0000</span>
                </div>
            </div>

            <!-- Ú©Ø§Ù†ÙˆØ§Ø³ Ø¨Ø§ Ø§ÙÚ©Øª Ø°Ø±Ø§Øª -->
            <div class="canvas-container">
                <canvas id="gameCanvas" width="500" height="500"></canvas>
                <canvas id="particleCanvas" class="particle-overlay" width="500" height="500"></canvas>
            </div>

            <!-- Ú©Ù†ØªØ±Ù„ Ù¾Ù†Ù„ Ø³Ø§ÛŒØ¨Ø±ÛŒ -->
            <div class="power-panel">
                <div class="status-hologram">
                    <span class="pulse" id="statusIndicator"></span>
                    <span id="statusText" style="color: #b0ffff; font-weight: bold;">SYSTEM ACTIVE</span>
                </div>
                
                <div class="speed-indicator">
                    <span>âš¡ Ø³Ø±Ø¹Øª</span>
                    <div class="speed-bar">
                        <div id="speedFill" class="speed-fill" style="width: 40%;"></div>
                    </div>
                    <span id="speedLevel">Ù†Ø±Ù…Ø§Ù„</span>
                </div>

                <div class="achievement-badge">
                    <span class="badge" id="comboBadge">ğŸ”¥ Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚Ù</span>
                </div>
            </div>

            <!-- Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
            <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; justify-content: center;">
                <button id="pauseToggleBtn" class="cyber-btn" style="background: #3a2a4a; border-color: #a569bd;">
                    <span>â¸ï¸</span> ØªÙˆÙ‚Ù
                </button>
                <button id="restartBtn" class="cyber-btn" style="background: #1e4a4a; border-color: #2e8b57;">
                    <span>ğŸ”„</span> Ø´Ø±ÙˆØ¹ Ù†Ùˆ
                </button>
                <button id="hardModeBtn" class="cyber-btn" style="background: #4a1e2a; border-color: #b03a4a;">
                    <span>â˜ ï¸</span> Ø­Ø§Ù„Øª Ø¬Ù‡Ù†Ù…ÛŒ
                </button>
            </div>

            <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ù‡Øª Ù†Ø¦ÙˆÙ† -->
            <div class="direction-command">
                <div class="neon-pad">
                    <div class="direction-row">
                        <button class="dir-btn" id="btnUp">â¬†ï¸</button>
                    </div>
                    <div class="direction-row">
                        <button class="dir-btn" id="btnLeft">â¬…ï¸</button>
                        <button class="dir-btn" id="btnDown">â¬‡ï¸</button>
                        <button class="dir-btn" id="btnRight">â¡ï¸</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===========================================
        //   SNAKE XTREME - Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡
        // ===========================================
        
        // ---------- Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ù‡Ø³ØªÙ‡ ----------
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const particleCanvas = document.getElementById('particleCanvas');
        const pCtx = particleCanvas.getContext('2d');
        
        // Ø¯ÛŒØ²Ø§ÛŒÙ† Ø³Ø§ÛŒØ² - 20x20 Ú¯Ø±ÛŒØ¯ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ
        const GRID_SIZE = 20;
        const CELL_SIZE = 25; // 500/20
        const BASE_SPEED = 100;
        
        // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
        let snake = [];
        let food = { x: 12, y: 10 };
        let specialFood = null;
        let direction = { x: 1, y: 0 };
        let nextDirection = { x: 1, y: 0 };
        let score = 0;
        let highScore = localStorage.getItem('snakeXtreme') ? parseInt(localStorage.getItem('snakeXtreme')) : 0;
        let gameActive = true;
        let gamePaused = false;
        let gameLoopInterval = null;
        let hardMode = false;
        let speedMultiplier = 1;
        let scoreMultiplier = 1;
        let combo = 0;
        let maxCombo = 0;
        let foodEatenCount = 0;
        let obstacles = [];
        let particles = [];
        
        // UI Ø¹Ù†Ø§ØµØ±
        const scoreElement = document.getElementById('scoreDisplay');
        const highScoreElement = document.getElementById('highScoreDisplay');
        const statusText = document.getElementById('statusText');
        const statusIndicator = document.getElementById('statusIndicator');
        const speedFill = document.getElementById('speedFill');
        const speedLevel = document.getElementById('speedLevel');
        const comboBadge = document.getElementById('comboBadge');
        
        // Ù†Ù…Ø§ÛŒØ´ Ø±Ú©ÙˆØ±Ø¯
        highScoreElement.textContent = highScore.toString().padStart(4, '0');
        
        // ---------- Ø³ÛŒØ³ØªÙ… Ø°Ø±Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡ ----------
        class Particle {
            constructor(x, y, color, type = 'glow') {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8;
                this.size = Math.random() * 6 + 2;
                this.color = color;
                this.life = 1.0;
                this.decay = 0.015 + Math.random() * 0.02;
                this.type = type;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.1;
                this.vx *= 0.98;
                this.vy *= 0.98;
                this.life -= this.decay;
                return this.life > 0;
            }
            
            draw() {
                pCtx.globalAlpha = this.life * 0.8;
                pCtx.shadowBlur = 15;
                pCtx.shadowColor = this.color;
                pCtx.fillStyle = this.color;
                pCtx.beginPath();
                pCtx.arc(this.x, this.y, this.size * this.life, 0, Math.PI * 2);
                pCtx.fill();
            }
        }
        
        // ---------- Ù…ÙˆØ§Ù†Ø¹ Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ© (Ø­Ø§Ù„Øª Ø¬Ù‡Ù†Ù…ÛŒ) ----------
        function generateObstacles() {
            obstacles = [];
            if (!hardMode) return;
            
            const count = Math.floor(score / 100) + 3;
            for (let i = 0; i < count; i++) {
                let x, y, valid;
                do {
                    valid = true;
                    x = Math.floor(Math.random() * GRID_SIZE);
                    y = Math.floor(Math.random() * GRID_SIZE);
                    
                    // Ø¨Ø±Ø±Ø³ÛŒ ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ Ù…Ø§Ø±
                    if (snake.some(s => s.x === x && s.y === y)) valid = false;
                    // ØªØ¯Ø§Ø®Ù„ Ø¨Ø§ ØºØ°Ø§
                    if (food.x === x && food.y === y) valid = false;
                    if (specialFood && specialFood.x === x && specialFood.y === y) valid = false;
                } while (!valid);
                
                obstacles.push({ x, y, hp: 2 });
            }
        }
        
        // ---------- ØºØ°Ø§ÛŒ ÙˆÛŒÚ˜Ù‡ (Ù‚Ø¯Ø±Øªâ€ŒØ§ÙØ²Ø§) ----------
        function generateSpecialFood() {
            if (foodEatenCount > 0 && foodEatenCount % 5 === 0 && !specialFood) {
                let attempts = 0;
                while (attempts < 500) {
                    const x = Math.floor(Math.random() * GRID_SIZE);
                    const y = Math.floor(Math.random() * GRID_SIZE);
                    if (!snake.some(s => s.x === x && s.y === y) && 
                        !(food.x === x && food.y === y) &&
                        !obstacles.some(o => o.x === x && o.y === y)) {
                        specialFood = { x, y, type: 'golden', timer: 200 }; // 200 Ø­Ø±Ú©Øª
                        break;
                    }
                    attempts++;
                }
            }
        }
        
        // ---------- Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ----------
        function initGame() {
            snake = [
                { x: 10, y: 10 },
                { x: 9, y: 10 },
                { x: 8, y: 10 },
                { x: 7, y: 10 }
            ];
            direction = { x: 1, y: 0 };
            nextDirection = { x: 1, y: 0 };
            score = 0;
            combo = 0;
            maxCombo = 0;
            foodEatenCount = 0;
            specialFood = null;
            scoreMultiplier = 1;
            scoreElement.textContent = '0000';
            gameActive = true;
            gamePaused = false;
            speedMultiplier = hardMode ? 1.5 : 1;
            updateSpeedUI();
            
            obstacles = [];
            if (hardMode) {
                generateObstacles();
            }
            
            statusText.textContent = 'SYSTEM ACTIVE';
            statusIndicator.style.background = '#0f0';
            statusIndicator.style.boxShadow = '0 0 20px #0f0';
            generateFood();
            draw();
        }
        
        // ---------- ØªÙˆÙ„ÛŒØ¯ ØºØ°Ø§ ----------
        function generateFood() {
            let attempts = 0;
            while (attempts < 1000) {
                const x = Math.floor(Math.random() * GRID_SIZE);
                const y = Math.floor(Math.random() * GRID_SIZE);
                
                if (!snake.some(s => s.x === x && s.y === y) && 
                    !obstacles.some(o => o.x === x && o.y === y)) {
                    food = { x, y };
                    
                    // Ø§ÛŒØ¬Ø§Ø¯ Ø°Ø±Ø§Øª ØºØ°Ø§
                    createParticles(x * CELL_SIZE + CELL_SIZE/2, y * CELL_SIZE + CELL_SIZE/2, '#ff6b6b', 12);
                    return;
                }
                attempts++;
            }
            
            // Ø§Ú¯Ø± Ø®Ø§Ù†Ù‡ Ø®Ø§Ù„ÛŒ Ù†Ø¨ÙˆØ¯
            if (snake.length >= GRID_SIZE * GRID_SIZE - obstacles.length) {
                gameWin();
            }
        }
        
        // ---------- Ø³ÛŒØ³ØªÙ… Ø°Ø±Ø§Øª ----------
        function createParticles(x, y, color, count = 10) {
            for (let i = 0; i < count; i++) {
                particles.push(new Particle(x, y, color));
            }
        }
        
        // ---------- Ø­Ø±Ú©Øª Ù…Ø§Ø± ----------
        function moveSnake() {
            if (!gameActive || gamePaused) return;
            
            direction = { ...nextDirection };
            
            const head = { x: snake[0].x + direction.x, y: snake[0].y + direction.y };
            
            // Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø¯ÛŒÙˆØ§Ø± (Ø­Ø§Ù„Øª Ø¬Ù‡Ù†Ù…ÛŒ = Ù…Ø±Ú¯ ÙÙˆØ±ÛŒ)
            if (head.x < 0 || head.x >= GRID_SIZE || head.y < 0 || head.y >= GRID_SIZE) {
                if (hardMode) {
                    gameOver();
                    return;
                } else {
                    // Ú©ÙØ±Ù…â€ŒÙ‡ÙˆÙ„ - Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ù‡ Ø³Ù…Øª Ù…Ù‚Ø§Ø¨Ù„
                    if (head.x < 0) head.x = GRID_SIZE - 1;
                    if (head.x >= GRID_SIZE) head.x = 0;
                    if (head.y < 0) head.y = GRID_SIZE - 1;
                    if (head.y >= GRID_SIZE) head.y = 0;
                }
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ù…ÙˆØ§Ù†Ø¹
            for (let obs of obstacles) {
                if (head.x === obs.x && head.y === obs.y) {
                    obs.hp--;
                    createParticles(head.x * CELL_SIZE + CELL_SIZE/2, head.y * CELL_SIZE + CELL_SIZE/2, '#ffaa00', 15);
                    if (obs.hp <= 0) {
                        obstacles = obstacles.filter(o => !(o.x === obs.x && o.y === obs.y));
                    }
                    // Ø¨Ù‡ Ù…Ø§Ø± Ø¢Ø³ÛŒØ¨ Ù…ÛŒâ€ŒØ²Ù†Ø¯ (Ø¯Ù… Ú©Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯)
                    if (snake.length > 2) {
                        snake.pop();
                    } else {
                        gameOver();
                        return;
                    }
                }
            }
            
            // Ø®ÙˆØ±Ø¯Ù† ØºØ°Ø§ÛŒ Ù…Ø¹Ù…ÙˆÙ„ÛŒ
            const ateFood = (head.x === food.x && head.y === food.y);
            let ateSpecial = false;
            if (specialFood && head.x === specialFood.x && head.y === specialFood.y) {
                ateSpecial = true;
                specialFood = null;
            }
            
            snake.unshift(head);
            
            if (ateFood) {
                // Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§ Ø¶Ø±ÛŒØ¨
                let points = 10 * scoreMultiplier;
                if (combo > 3) points *= 1.5;
                score += points;
                combo++;
                maxCombo = Math.max(maxCombo, combo);
                foodEatenCount++;
                
                updateScore();
                generateFood();
                generateSpecialFood();
                
                // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª Ø¯Ø± Ø­Ø§Ù„Øª Ø¬Ù‡Ù†Ù…ÛŒ
                if (hardMode && speedMultiplier < 2.5) {
                    speedMultiplier += 0.05;
                    updateSpeedUI();
                }
                
                // Ø°Ø±Ø§Øª Ø¬Ø´Ù†
                createParticles(head.x * CELL_SIZE + CELL_SIZE/2, head.y * CELL_SIZE + CELL_SIZE/2, '#00ffaa', 20);
            } else if (ateSpecial) {
                score += 50 * scoreMultiplier;
                combo += 2;
                updateScore();
                createParticles(head.x * CELL_SIZE + CELL_SIZE/2, head.y * CELL_SIZE + CELL_SIZE/2, '#ffd700', 30);
                scoreMultiplier = 2; // Ø¶Ø±ÛŒØ¨ Ø¯ÙˆØ¨Ø±Ø§Ø¨Ø± Ø¨Ù‡ Ù…Ø¯Øª Ù…Ø­Ø¯ÙˆØ¯
                setTimeout(() => { scoreMultiplier = 1; }, 5000);
            } else {
                snake.pop();
                combo = 0;
            }
            
            // Ú©Ø§Ù‡Ø´ ØªØ§ÛŒÙ…Ø± ØºØ°Ø§ÛŒ ÙˆÛŒÚ˜Ù‡
            if (specialFood) {
                specialFood.timer--;
                if (specialFood.timer <= 0) {
                    specialFood = null;
                }
            }
            
            // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø¨Ø¯Ù†
            for (let i = 1; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) {
                    gameOver();
                    return;
                }
            }
            
            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ù…Ø¨Ùˆ
            comboBadge.innerHTML = combo > 2 ? `ğŸ”¥ Ú©Ø§Ù…Ø¨Ùˆ x${combo}` : 'â„ï¸ Ø¨Ø¯ÙˆÙ† ØªÙˆÙ‚Ù';
            
            draw();
        }
        
        // ---------- Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù…ØªÛŒØ§Ø² ----------
        function updateScore() {
            scoreElement.textContent = Math.floor(score).toString().padStart(4, '0');
            if (score > highScore) {
                highScore = Math.floor(score);
                localStorage.setItem('snakeXtreme', highScore);
                highScoreElement.textContent = highScore.toString().padStart(4, '0');
            }
        }
        
        // ---------- Game Over ----------
        function gameOver() {
            gameActive = false;
            clearInterval(gameLoopInterval);
            statusText.textContent = 'ğŸ’€ GAME OVER';
            statusIndicator.style.background = '#ff0000';
            statusIndicator.style.boxShadow = '0 0 20px red';
            createParticles(canvas.width/2, canvas.height/2, '#ff3333', 50);
            draw();
        }
        
        function gameWin() {
            gameActive = false;
            clearInterval(gameLoopInterval);
            statusText.textContent = 'ğŸ† WINNER!';
            statusIndicator.style.background = '#ffd700';
            statusIndicator.style.boxShadow = '0 0 30px gold';
        }
        
        // ---------- Ø±Ø³Ù… Ù¾ÛŒØ´Ø±ÙØªÙ‡ ----------
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Ú¯Ø±ÛŒØ¯ Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ
            ctx.fillStyle = '#0a0e14';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ø³ØªØ§Ø±Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡
            ctx.fillStyle = '#ffffff';
            for (let i = 0; i < 100; i++) {
                if (i % 2 === 0) {
                    ctx.globalAlpha = 0.3;
                    ctx.fillRect(i * 13 % canvas.width, i * 7 % canvas.height, 1, 1);
                }
            }
            ctx.globalAlpha = 1;
            
            // Ø±Ø³Ù… Ù…ÙˆØ§Ù†Ø¹
            obstacles.forEach(obs => {
                const x = obs.x * CELL_SIZE;
                const y = obs.y * CELL_SIZE;
                
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#ff5500';
                ctx.fillStyle = '#b03a4a';
                ctx.beginPath();
                ctx.roundRect(x + 2, y + 2, CELL_SIZE - 4, CELL_SIZE - 4, 6);
                ctx.fill();
                
                ctx.fillStyle = '#ff8c5a';
                ctx.font = 'bold 16px Orbitron';
                ctx.fillText('âš ï¸', x + 5, y + 20);
            });
            
            // Ø±Ø³Ù… ØºØ°Ø§ÛŒ ÙˆÛŒÚ˜Ù‡
            if (specialFood) {
                const x = specialFood.x * CELL_SIZE;
                const y = specialFood.y * CELL_SIZE;
                ctx.shadowBlur = 30;
                ctx.shadowColor = '#ffd700';
                
                // Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ú†Ø±Ø®Ø´
                ctx.fillStyle = '#ffd700';
                ctx.beginPath();
                ctx.arc(x + CELL_SIZE/2, y + CELL_SIZE/2, CELL_SIZE/2 - 2, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 20px Orbitron';
                ctx.fillText('â­', x + 4, y + 20);
            }
            
            // Ø±Ø³Ù… ØºØ°Ø§
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#ff3333';
            ctx.fillStyle = '#ff4757';
            ctx.beginPath();
            ctx.arc(food.x * CELL_SIZE + CELL_SIZE/2, food.y * CELL_SIZE + CELL_SIZE/2, CELL_SIZE/2 - 2, 0, Math.PI * 2);
            ctx.fill();
            
            // Ø±Ø³Ù… Ù…Ø§Ø±
            snake.forEach((segment, index) => {
                const x = segment.x * CELL_SIZE;
                const y = segment.y * CELL_SIZE;
                
                ctx.shadowBlur = index === 0 ? 25 : 12;
                ctx.shadowColor = index === 0 ? '#00ffaa' : '#00aaff';
                
                // Ø¨Ø¯Ù†Ù‡ Ø¨Ø§ Ú¯Ø±Ø§Ø¯ÛŒÙ†Øª
                const gradient = ctx.createRadialGradient(x + 5, y + 5, 2, x + 12, y + 12, 18);
                if (index === 0) {
                    gradient.addColorStop(0, '#8affcf');
                    gradient.addColorStop(1, '#00cc88');
                } else {
                    gradient.addColorStop(0, '#6ac5ff');
                    gradient.addColorStop(1, '#0088cc');
                }
                
                ctx.fillStyle = gradient;
                ctx.beginPath();
                ctx.roundRect(x + 2, y + 2, CELL_SIZE - 4, CELL_SIZE - 4, 8);
                ctx.fill();
                
                // Ú†Ø´Ù… Ø³Ø±
                if (index === 0) {
                    ctx.shadowBlur = 5;
                    ctx.fillStyle = '#ffffff';
                    ctx.beginPath();
                    ctx.arc(x + 16, y + 8, 4, 0, 2 * Math.PI);
                    ctx.arc(x + 8, y + 8, 4, 0, 2 * Math.PI);
                    ctx.fill();
                    ctx.fillStyle = '#0a0a1a';
                    ctx.beginPath();
                    ctx.arc(x + 17, y + 7, 2, 0, 2 * Math.PI);
                    ctx.arc(x + 9, y + 7, 2, 0, 2 * Math.PI);
                    ctx.fill();
                }
            });
            
            ctx.shadowBlur = 0;
            
            // Ù†Ù…Ø§ÛŒØ´ Game Over
            if (!gameActive && !gamePaused) {
                ctx.font = 'bold 36px Orbitron, Vazirmatn';
                ctx.fillStyle = '#ff6b6b';
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#ff0000';
                ctx.fillText('GAME OVER', canvas.width/2 - 130, canvas.height/2);
                ctx.shadowBlur = 0;
            }
        }
        
        // Ø±Ø³Ù… Ø°Ø±Ø§Øª
        function drawParticles() {
            pCtx.clearRect(0, 0, canvas.width, canvas.height);
            particles = particles.filter(p => p.update());
            particles.forEach(p => p.draw());
            requestAnimationFrame(drawParticles);
        }
        
        // ---------- Ú©Ù†ØªØ±Ù„Ø±Ù‡Ø§ ----------
        function setDirection(newDir) {
            if (!gameActive || gamePaused) return;
            if ((direction.x === -newDir.x && direction.y === -newDir.y)) return;
            nextDirection = newDir;
        }
        
        function togglePause() {
            if (!gameActive) return;
            gamePaused = !gamePaused;
            const btn = document.getElementById('pauseToggleBtn');
            if (gamePaused) {
                clearInterval(gameLoopInterval);
                btn.innerHTML = '<span>â–¶ï¸</span> Ø§Ø¯Ø§Ù…Ù‡';
                statusText.textContent = 'PAUSED';
                statusIndicator.style.background = '#ffaa00';
            } else {
                startGameLoop();
                btn.innerHTML = '<span>â¸ï¸</span> ØªÙˆÙ‚Ù';
                statusText.textContent = 'SYSTEM ACTIVE';
                statusIndicator.style.background = '#0f0';
            }
            draw();
        }
        
        function updateSpeedUI() {
            let speedPercent = Math.min(100, (speedMultiplier / 2.5) * 100);
            speedFill.style.width = speedPercent + '%';
            if (speedMultiplier < 1.2) speedLevel.textContent = 'Ù†Ø±Ù…Ø§Ù„';
            else if (speedMultiplier < 1.8) speedLevel.textContent = 'Ø³Ø±ÛŒØ¹';
            else speedLevel.textContent = 'Ø¨Ø±Ù‚ Ø¢Ø³Ø§';
        }
        
        function startGameLoop() {
            if (gameLoopInterval) clearInterval(gameLoopInterval);
            if (gameActive && !gamePaused) {
                let speed = Math.max(50, BASE_SPEED / speedMultiplier);
                gameLoopInterval = setInterval(moveSnake, speed);
            }
        }
        
        // ---------- Ø§ÛŒÙˆÙ†Øªâ€ŒÙ‡Ø§ ----------
        window.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowUp': e.preventDefault(); setDirection({ x: 0, y: -1 }); break;
                case 'ArrowDown': e.preventDefault(); setDirection({ x: 0, y: 1 }); break;
                case 'ArrowLeft': e.preventDefault(); setDirection({ x: -1, y: 0 }); break;
                case 'ArrowRight': e.preventDefault(); setDirection({ x: 1, y: 0 }); break;
                case ' ': e.preventDefault(); togglePause(); break;
                case 'h': case 'H': toggleHardMode(); break;
            }
        });
        
        document.getElementById('btnUp').addEventListener('click', () => setDirection({ x: 0, y: -1 }));
        document.getElementById('btnDown').addEventListener('click', () => setDirection({ x: 0, y: 1 }));
        document.getElementById('btnLeft').addEventListener('click', () => setDirection({ x: -1, y: 0 }));
        document.getElementById('btnRight').addEventListener('click', () => setDirection({ x: 1, y: 0 }));
        document.getElementById('pauseToggleBtn').addEventListener('click', togglePause);
        document.getElementById('restartBtn').addEventListener('click', () => {
            clearInterval(gameLoopInterval);
            initGame();
            startGameLoop();
        });
        
        // Ø­Ø§Ù„Øª Ø¬Ù‡Ù†Ù…ÛŒ
        function toggleHardMode() {
            hardMode = !hardMode;
            const btn = document.getElementById('hardModeBtn');
            if (hardMode) {
                btn.style.background = '#6a1e2a';
                btn.style.borderColor = '#ff4d4d';
                btn.innerHTML = '<span>ğŸ‘¹</span> Ø¬Ù‡Ù†Ù… ÙØ¹Ø§Ù„';
            } else {
                btn.style.background = '#4a1e2a';
                btn.style.borderColor = '#b03a4a';
                btn.innerHTML = '<span>â˜ ï¸</span> Ø­Ø§Ù„Øª Ø¬Ù‡Ù†Ù…ÛŒ';
            }
            clearInterval(gameLoopInterval);
            initGame();
            startGameLoop();
        }
        
        document.getElementById('hardModeBtn').addEventListener('click', toggleHardMode);
        
        // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„
        window.addEventListener('keydown', (e) => {
            if (e.key.startsWith('Arrow')) e.preventDefault();
        }, false);
        
        // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
        CanvasRenderingContext2D.prototype.roundRect = function (x, y, w, h, r) {
            if (w < 2 * r) r = w / 2;
            if (h < 2 * r) r = h / 2;
            this.moveTo(x + r, y);
            this.lineTo(x + w - r, y);
            this.quadraticCurveTo(x + w, y, x + w, y + r);
            this.lineTo(x + w, y + h - r);
            this.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
            this.lineTo(x + r, y + h);
            this.quadraticCurveTo(x, y + h, x, y + h - r);
            this.lineTo(x, y + r);
            this.quadraticCurveTo(x, y, x + r, y);
            return this;
        };
        
        initGame();
        startGameLoop();
        requestAnimationFrame(drawParticles);
    </script>
</body>
</html>
