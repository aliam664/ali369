<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ø¨Ø§Ø²ÛŒ Ù…Ø§Ø± - Ù†Ø³Ø®Ù‡ Ú¯ÙˆØ´ÛŒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(145deg, #1a4d2a 0%, #1e5a2e 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100dvh;
            width: 100%;
            padding: 12px;
            margin: 0;
        }

        .game-container {
            max-width: 500px;
            width: 100%;
            background: #1f3b2c;
            border-radius: 32px;
            padding: 20px 16px;
            box-shadow: 0 20px 35px rgba(0, 0, 0, 0.5);
            border: 1px solid #4f9a5e;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8px 15px 8px;
            color: #ffd966;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 2px 2px 0 #1e3a1e;
        }

        .score-box, .high-score-box {
            background: #0f2a1a;
            padding: 8px 18px;
            border-radius: 40px;
            box-shadow: inset 0 -3px 0 #3a5a3a, inset 0 2px 5px rgba(0,0,0,0.5);
            border: 1px solid #6f9e7a;
            color: #ffeeaa;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .canvas-wrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            background: #0a1e12;
            border-radius: 20px;
            padding: 10px;
            box-shadow: inset 0 0 0 2px #2b5e2b, inset 0 0 15px #00000070;
            margin-bottom: 12px;
        }

        canvas {
            display: block;
            width: 100%;
            height: auto;
            aspect-ratio: 1 / 1;
            background: #0d2619;
            border-radius: 12px;
            image-rendering: crisp-edges;
            image-rendering: pixelated;
            border: 2px solid #4a8c5a;
            max-width: 400px;
            margin: 0 auto;
        }

        .control-panel {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            margin-top: 12px;
        }

        .dpad {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .dpad-row {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 5px 0;
        }

        .control-btn {
            background: #3e6b47;
            border: none;
            border-bottom: 6px solid #1e3a1e;
            color: white;
            font-size: 2.2rem;
            width: 80px;
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 25px;
            box-shadow: 0 8px 0 #152615, 0 12px 20px black;
            transition: all 0.03s ease;
            cursor: pointer;
            font-weight: bold;
            -webkit-touch-callout: none;
        }

        .control-btn:active {
            transform: translateY(8px);
            box-shadow: 0 2px 0 #152615, 0 12px 20px black;
            border-bottom-width: 2px;
            background: #5c9c6e;
        }

        .action-btn {
            background: #b9793b;
            border-bottom-color: #6b431e;
            font-size: 1.8rem;
            width: 130px;
            height: 65px;
            border-radius: 40px;
        }

        .restart-btn {
            background: #9e3c3c;
            border-bottom-color: #4f1e1e;
            font-size: 1.6rem;
            width: 160px;
        }

        .button-text {
            font-size: 1.4rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (max-width: 450px) {
            .control-btn {
                width: 70px;
                height: 70px;
                font-size: 2rem;
            }
            .action-btn {
                width: 120px;
                height: 60px;
            }
        }

        @media (max-width: 350px) {
            .control-btn {
                width: 60px;
                height: 60px;
                font-size: 1.8rem;
            }
        }

        .status {
            color: #fbe192;
            font-size: 1.1rem;
            margin-top: 8px;
            padding: 5px;
            background: #1c331cba;
            border-radius: 30px;
            width: fit-content;
            padding: 6px 25px;
            margin-right: auto;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <div class="score-box">
                <span>ğŸ</span>
                <span id="scoreDisplay">0</span>
            </div>
            <div class="high-score-box">
                <span>ğŸ†</span>
                <span id="highScoreDisplay">0</span>
            </div>
        </div>

        <div class="canvas-wrapper">
            <canvas id="gameCanvas" width="400" height="400"></canvas>
        </div>

        <div class="status" id="statusMessage">â–¶ï¸ Ø¨Ø§Ø²ÛŒ Ø±Ø§ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒØ¯</div>

        <div class="control-panel">
            <div class="dpad">
                <div class="dpad-row">
                    <button class="control-btn" id="btnUp" aria-label="Ø¨Ø§Ù„Ø§">â¬†ï¸</button>
                </div>
                <div class="dpad-row">
                    <button class="control-btn" id="btnLeft" aria-label="Ú†Ù¾">â¬…ï¸</button>
                    <button class="control-btn" id="btnDown" aria-label="Ù¾Ø§ÛŒÛŒÙ†">â¬‡ï¸</button>
                    <button class="control-btn" id="btnRight" aria-label="Ø±Ø§Ø³Øª">â¡ï¸</button>
                </div>
            </div>
            
            <div class="dpad-row">
                <button class="control-btn action-btn" id="btnPause">â¸ï¸ ØªÙˆÙ‚Ù</button>
                <button class="control-btn restart-btn" id="btnRestart">ğŸ”„ Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
            </div>
        </div>
    </div>

    <script>
        (function(){
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const scoreSpan = document.getElementById('scoreDisplay');
            const highScoreSpan = document.getElementById('highScoreDisplay');
            const statusEl = document.getElementById('statusMessage');

            // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§Ø²ÛŒ
            const gridSize = 20;
            const tileCount = canvas.width / gridSize; // 20

            let snake = [
                {x: 10, y: 10}
            ];
            let direction = {x: 0, y: 0};
            let food = {x: 15, y: 15};
            let score = 0;
            let highScore = localStorage.getItem('snakeHighScore') ? parseInt(localStorage.getItem('snakeHighScore')) : 0;
            let gameRunning = false;
            let gamePaused = false;
            let gameInterval = null;
            let gameSpeed = 110; // Ù…ÛŒÙ„ÛŒâ€ŒØ«Ø§Ù†ÛŒÙ‡

            // Ù†Ù…Ø§ÛŒØ´ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§
            highScoreSpan.innerText = highScore;

            // ØªØ§Ø¨Ø¹ ØªÙˆÙ„ÛŒØ¯ ØºØ°Ø§ Ø¯Ø± Ù…ÙˆÙ‚Ø¹ÛŒØª ØªØµØ§Ø¯ÙÛŒ
            function generateFood() {
                let newFood;
                let foodOnSnake;
                
                do {
                    foodOnSnake = false;
                    newFood = {
                        x: Math.floor(Math.random() * tileCount),
                        y: Math.floor(Math.random() * tileCount)
                    };
                    
                    for (let segment of snake) {
                        if (segment.x === newFood.x && segment.y === newFood.y) {
                            foodOnSnake = true;
                            break;
                        }
                    }
                } while (foodOnSnake);
                
                food = newFood;
            }

            // Ø±Ø³Ù… Ø¨Ø§Ø²ÛŒ
            function drawGame() {
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØµÙØ­Ù‡
                ctx.fillStyle = '#0d2619';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Ø±Ø³Ù… Ø´Ø¨Ú©Ù‡ Ø®Ø·ÙˆØ· (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
                ctx.strokeStyle = '#1e4a2a33';
                ctx.lineWidth = 0.5;
                for (let i = 0; i < tileCount; i++) {
                    ctx.beginPath();
                    ctx.moveTo(i * gridSize, 0);
                    ctx.lineTo(i * gridSize, canvas.height);
                    ctx.strokeStyle = '#2b5a2b33';
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(0, i * gridSize);
                    ctx.lineTo(canvas.width, i * gridSize);
                    ctx.stroke();
                }

                // Ø±Ø³Ù… Ù…Ø§Ø±
                ctx.fillStyle = '#82c91e';
                ctx.shadowColor = '#b3ff8f';
                ctx.shadowBlur = 6;
                
                for (let i = 0; i < snake.length; i++) {
                    const segment = snake[i];
                    if (i === 0) {
                        // Ø³Ø± Ù…Ø§Ø±
                        ctx.fillStyle = '#a4de42';
                        ctx.shadowBlur = 10;
                    } else {
                        ctx.fillStyle = '#5fa83d';
                        ctx.shadowBlur = 5;
                    }
                    
                    ctx.fillRect(segment.x * gridSize + 1, segment.y * gridSize + 1, gridSize - 2, gridSize - 2);
                    
                    // Ú†Ø´Ù… Ø¨Ø±Ø§ÛŒ Ø³Ø± Ù…Ø§Ø±
                    if (i === 0) {
                        ctx.fillStyle = 'white';
                        ctx.shadowBlur = 0;
                        // Ú†Ø´Ù…â€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ù‡Øª
                        ctx.beginPath();
                        ctx.arc(segment.x * gridSize + 6, segment.y * gridSize + 6, 2.5, 0, Math.PI * 2);
                        ctx.arc(segment.x * gridSize + 14, segment.y * gridSize + 6, 2.5, 0, Math.PI * 2);
                        ctx.fillStyle = 'white';
                        ctx.fill();
                        ctx.fillStyle = '#0a0a0a';
                        ctx.beginPath();
                        ctx.arc(segment.x * gridSize + 6, segment.y * gridSize + 6, 1.2, 0, Math.PI * 2);
                        ctx.arc(segment.x * gridSize + 14, segment.y * gridSize + 6, 1.2, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                // Ø±Ø³Ù… ØºØ°Ø§
                ctx.shadowBlur = 12;
                ctx.shadowColor = '#ffbb33';
                ctx.fillStyle = '#ff4444';
                ctx.beginPath();
                ctx.arc(food.x * gridSize + gridSize/2, food.y * gridSize + gridSize/2, gridSize/2 - 2, 0, Math.PI * 2);
                ctx.fill();
                
                // Ø¨Ø±Ø¢Ù…Ø¯Ú¯ÛŒ Ø³ÛŒØ¨
                ctx.fillStyle = '#66bb6a';
                ctx.shadowBlur = 6;
                ctx.beginPath();
                ctx.arc(food.x * gridSize + 8, food.y * gridSize + 7, 3, 0, Math.PI * 2);
                ctx.fill();

                ctx.shadowBlur = 0;
                ctx.shadowColor = 'transparent';
            }

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØª Ù…Ø§Ø±
            function updateGame() {
                if (!gameRunning || gamePaused) return;

                const head = {x: snake[0].x + direction.x, y: snake[0].y + direction.y};

                // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø¯ÛŒÙˆØ§Ø± (Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯)
                if (head.x < 0 || head.x >= tileCount || head.y < 0 || head.y >= tileCount) {
                    gameOver();
                    return;
                }

                // Ø¨Ø±Ø±Ø³ÛŒ Ø¨Ø±Ø®ÙˆØ±Ø¯ Ø¨Ø§ Ø®ÙˆØ¯ Ù…Ø§Ø±
                for (let segment of snake) {
                    if (head.x === segment.x && head.y === segment.y) {
                        gameOver();
                        return;
                    }
                }

                snake.unshift(head);

                // Ø¨Ø±Ø±Ø³ÛŒ Ø®ÙˆØ±Ø¯Ù† ØºØ°Ø§
                if (head.x === food.x && head.y === food.y) {
                    score += 10;
                    scoreSpan.innerText = score;
                    generateFood();
                    
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø§Ù…ØªÛŒØ§Ø² Ø¨Ø§Ù„Ø§
                    if (score > highScore) {
                        highScore = score;
                        localStorage.setItem('snakeHighScore', highScore);
                        highScoreSpan.innerText = highScore;
                    }
                    
                    // Ø§ÙØ²Ø§ÛŒØ´ Ø³Ø±Ø¹Øª Ù‡Ø± ÛµÛ° Ø§Ù…ØªÛŒØ§Ø²
                    if (score % 50 === 0 && gameSpeed > 50) {
                        gameSpeed -= 10;
                        resetInterval();
                    }
                } else {
                    snake.pop();
                }

                drawGame();
            }

            function resetInterval() {
                if (gameInterval) {
                    clearInterval(gameInterval);
                }
                if (gameRunning && !gamePaused) {
                    gameInterval = setInterval(updateGame, gameSpeed);
                }
            }

            function gameOver() {
                gameRunning = false;
                gamePaused = false;
                if (gameInterval) {
                    clearInterval(gameInterval);
                    gameInterval = null;
                }
                statusEl.innerHTML = 'ğŸ’€ Ø¨Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯! Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡';
                drawGame();
            }

            function restartGame() {
                // Ø±ÛŒØ³Øª Ú©Ø§Ù…Ù„
                snake = [{x: 10, y: 10}];
                direction = {x: 0, y: 0};
                score = 0;
                gameSpeed = 110;
                scoreSpan.innerText = '0';
                gameRunning = true;
                gamePaused = false;
                
                generateFood();
                
                if (gameInterval) clearInterval(gameInterval);
                gameInterval = setInterval(updateGame, gameSpeed);
                drawGame();
                statusEl.innerHTML = 'ğŸ® Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²ÛŒ...';
            }

            function pauseGame() {
                if (!gameRunning) return;
                
                gamePaused = !gamePaused;
                if (gamePaused) {
                    clearInterval(gameInterval);
                    gameInterval = null;
                    statusEl.innerHTML = 'â¸ï¸ Ù…Ú©Ø«';
                } else {
                    gameInterval = setInterval(updateGame, gameSpeed);
                    statusEl.innerHTML = 'ğŸ® Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø²ÛŒ...';
                }
            }

            // ØªÙ†Ø¸ÛŒÙ… Ø¬Ù‡Øª
            function setDirection(newDirX, newDirY) {
                if (!gameRunning || gamePaused) return;
                
                // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø­Ø±Ú©Øª Ø¨Ø±Ø¹Ú©Ø³
                if ((direction.x === -newDirX && direction.y === -newDirY) || 
                    (direction.y === -newDirY && direction.x === -newDirX)) {
                    return;
                }
                
                direction = {x: newDirX, y: newDirY};
            }

            // Ú©Ù†ØªØ±Ù„ Ø¨Ø§ Ú©ÛŒØ¨ÙˆØ±Ø¯ (Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯ Ø±ÙˆÛŒ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±)
            window.addEventListener('keydown', (e) => {
                if (!gameRunning || gamePaused) return;
                
                switch(e.key) {
                    case 'ArrowUp': e.preventDefault(); setDirection(0, -1); break;
                    case 'ArrowDown': e.preventDefault(); setDirection(0, 1); break;
                    case 'ArrowLeft': e.preventDefault(); setDirection(-1, 0); break;
                    case 'ArrowRight': e.preventDefault(); setDirection(1, 0); break;
                    case ' ': e.preventDefault(); pauseGame(); break;
                }
            });

            // Ø±ÙˆÛŒØ¯Ø§Ø¯Ù‡Ø§ÛŒ Ù„Ù…Ø³ÛŒ Ø¨Ø±Ø§ÛŒ Ú¯ÙˆØ´ÛŒ
            function attachEvents() {
                document.getElementById('btnUp').addEventListener('click', (e) => { e.preventDefault(); setDirection(0, -1); });
                document.getElementById('btnDown').addEventListener('click', (e) => { e.preventDefault(); setDirection(0, 1); });
                document.getElementById('btnLeft').addEventListener('click', (e) => { e.preventDefault(); setDirection(-1, 0); });
                document.getElementById('btnRight').addEventListener('click', (e) => { e.preventDefault(); setDirection(1, 0); });
                document.getElementById('btnPause').addEventListener('click', (e) => { e.preventDefault(); pauseGame(); });
                document.getElementById('btnRestart').addEventListener('click', (e) => { e.preventDefault(); restartGame(); });
            }

            attachEvents();

            // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ ÛŒÚ© Ø§Ø³ØªØ§Ø±Øª Ø§ÙˆÙ„ÛŒÙ‡ (Ø¬Ù‡Øª ØµÙØ± ØªØ§ Ø­Ø±Ú©Øª Ù†Ú©Ù†Ø¯)
            // ÛŒÚ© Ø¨Ø§Ø± ØµÙØ­Ù‡ Ø±Ø³Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ù…Ù†ØªØ¸Ø± Ú©Ù„ÛŒÚ© Ø±ÙˆÛŒ start Ù‡Ø³ØªÛŒÙ…
            drawGame();
            
            // Ø¨Ø§ Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            // Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ†Ú©Ù‡ Ø¨Ø§Ø²ÛŒ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ Ø§Ø¬Ø±Ø§ Ù†Ø´ÙˆØ¯ ÙˆÙ„ÛŒ Ø¯Ú©Ù…Ù‡ Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ú©Ø§Ø± Ú©Ù†Ø¯
            // gameRunning = false; 

            // Ù†Ù…Ø§ÛŒØ´ ØºØ°Ø§ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§
            generateFood();
            drawGame();
            
            // ÙˆÙ‚ØªÛŒ ØµÙØ­Ù‡ Ù„ÙˆØ¯ Ø´Ø¯ status Ù…Ù†Ø§Ø³Ø¨
            statusEl.innerHTML = 'ğŸ‘† Ø¯Ú©Ù…Ù‡ "Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡" Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯';
            
            // Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² Ø§Ø³Ú©Ø±ÙˆÙ„ Ø´Ø¯Ù† ØµÙØ­Ù‡ Ø¨Ø§ ØªØ§Ú† Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                });
            });
            
            // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ Ø±ÛŒØ³Øª (Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ø¨Ø²Ù†Ø¯)
            // Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± restart Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯
        })();
    </script>
</body>
</html>